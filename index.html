<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ことばポーカー - マルチプレイ</title>
    <style>
        /* （既存のスタイルを維持） */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; color:#333; }
        .container { max-width:1400px; margin:0 auto; padding:20px; }
        .header { text-align:center; color:white; margin-bottom:30px; }
        .game-setup { background:white; padding:30px; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 6px rgba(0,0,0,0.1); text-align:center; }
        .player-input-area { margin:20px 0; }
        .player-input { display:flex; gap:10px; justify-content:center; margin:10px 0; align-items:center; }
        .player-input input { padding:10px; border:2px solid #cbd5e0; border-radius:6px; font-size:16px; width:200px; }
        .player-badge { display:inline-block; padding:5px 15px; border-radius:20px; margin:5px; font-weight:bold; color:white; }
        .game-area { display:none; } /* 初期は非表示 */
        .game-info { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:15px; background:white; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
        .info-item { text-align:center; }
        .current-player-indicator { background:linear-gradient(145deg,#48bb78,#38a169); color:white; padding:10px 20px; border-radius:10px; text-align:center; margin-bottom:20px; font-size:20px; font-weight:bold; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
        .players-area { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; margin-bottom:20px; }
        .player-card { background:white; padding:15px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1); transition:all 0.3s ease; }
        .player-card.active { background:linear-gradient(145deg,#ffd700,#ffa500); transform:scale(1.05); }
        .player-card.waiting { opacity:0.7; }
        .player-name { font-size:18px; font-weight:bold; margin-bottom:10px; }
        .player-stats { display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:14px; }
        .hand-area { background:white; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
        .cards { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:20px 0; }
        .card { width:60px; height:80px; background:linear-gradient(145deg,#f0f0f0,#cacaca); border:2px solid #ddd; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:bold; cursor:pointer; transition:all 0.3s ease; user-select:none; }
        .card:hover { transform:translateY(-5px); box-shadow:0 6px 12px rgba(0,0,0,0.2); }
        .card.selected { background:linear-gradient(145deg,#ffd700,#ffa500); border-color:#ff8c00; transform:translateY(-10px); }
        .selected-cards { background:#e2e8f0; padding:15px; border-radius:8px; margin:15px 0; min-height:60px; border:2px dashed #cbd5e0; }
        .selected-cards h4 { margin-bottom:10px; color:#4a5568; }
        .selected-card-area { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
        .controls { display:flex; gap:10px; justify-content:center; margin-top:10px; }
        button { padding:10px 20px; border-radius:6px; border:none; cursor:pointer; font-weight:bold; }
        .btn-primary { background:#2b6cb0; color:white; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ことばポーカー - マルチプレイ</h1>
        </header>

        <section class="game-setup">
            <div class="player-input-area">
                <div class="player-input">
                    <input id="player-name" placeholder="あなたの名前を入力" />
                    <!-- 他プレイヤー登録UIがあれば残す -->
                </div>
            </div>
            <!-- ゲーム開始ボタン（id を固定してイベントを確実にバインド） -->
            <div class="controls">
                <button id="start-game" class="btn-primary">ゲーム開始</button>
            </div>
        </section>

        <!-- ゲーム本体エリア（開始前は非表示） -->
        <section class="game-area" aria-hidden="true">
            <div class="game-info">
                <div class="info-item">
                    <h3>ラウンド</h3>
                    <p id="round-number">0</p>
                </div>
                <div class="info-item">
                    <h3>残りカード</h3>
                    <p id="deck-count">0</p>
                </div>
                <div class="info-item">
                    <h3>現在のプレイヤー</h3>
                    <p id="current-player">-</p>
                </div>
            </div>

            <div class="current-player-indicator" id="current-player-indicator">準備中</div>

            <div class="players-area" id="players-area">
                <!-- プレイヤーカードを動的に挿入 -->
            </div>

            <div class="hand-area">
                <h3>あなたの手札</h3>
                <div class="cards" id="hand-cards">
                    <!-- サンプルカード -->
                    <div class="card" data-value="あ">あ</div>
                    <div class="card" data-value="い">い</div>
                    <div class="card" data-value="う">う</div>
                    <div class="card" data-value="え">え</div>
                    <div class="card" data-value="お">お</div>
                </div>

                <div class="selected-cards">
                    <h4>選択中のカード</h4>
                    <div class="selected-card-area" id="selected-area"></div>
                </div>

                <div class="controls">
                    <button id="confirm-play" class="btn-primary">出す</button>
                    <button id="pass-turn">パス</button>
                </div>
            </div>
        </section>
    </div>

    <script>
    // DOM が構築されてから初期化（重要）
    document.addEventListener('DOMContentLoaded', () => {
        const startBtn = document.getElementById('start-game');
        const gameArea = document.querySelector('.game-area');
        const handCards = document.getElementById('hand-cards');
        const selectedArea = document.getElementById('selected-area');
        const roundNumberEl = document.getElementById('round-number');
        const deckCountEl = document.getElementById('deck-count');
        const currentPlayerEl = document.getElementById('current-player');
        const confirmPlayBtn = document.getElementById('confirm-play');
        const passBtn = document.getElementById('pass-turn');

        if (!startBtn) {
            console.warn('start-game ボタンが見つかりません。HTML 内に #start-game を確認してください。');
            return;
        }

        // カードクリックは event delegation で安定動作
        if (handCards) {
            handCards.addEventListener('click', (ev) => {
                const card = ev.target.closest('.card');
                if (!card) return;
                // トグル選択
                card.classList.toggle('selected');
                updateSelectedArea();
            });
        } else {
            console.warn('.cards 要素が見つかりません。id="hand-cards" を確認してください。');
        }

        // ゲーム開始ボタン
        startBtn.addEventListener('click', (e) => {
            e.preventDefault();
            startGame();
        });

        // 出すボタン
        if (confirmPlayBtn) {
            confirmPlayBtn.addEventListener('click', () => {
                const selected = Array.from(document.querySelectorAll('.card.selected')).map(c => c.dataset.value || c.textContent.trim());
                if (selected.length === 0) {
                    alert('カードを選択してください');
                    return;
                }
                // TODO: ここでサーバ送信やゲームロジック呼び出し
                console.log('プレイするカード:', selected);
                // 選択を解除（UI 更新）
                document.querySelectorAll('.card.selected').forEach(c => c.classList.remove('selected'));
                updateSelectedArea();
            });
        }

        if (passBtn) {
            passBtn.addEventListener('click', () => {
                // TODO: パス処理
                console.log('パスしました');
            });
        }

        function startGame() {
            // ゲーム開始時の初期化。既存ロジックに合わせて拡張してください。
            console.log('ゲームを開始します');
            if (gameArea) {
                gameArea.style.display = 'block';
                gameArea.setAttribute('aria-hidden', 'false');
            }
            roundNumberEl.textContent = '1';
            deckCountEl.textContent = '99'; // 実数値に差し替えてください
            currentPlayerEl.textContent = document.getElementById('player-name')?.value || 'あなた';
            document.getElementById('current-player-indicator').textContent = 'あなたの番';
            // 必要ならここで WebSocket 接続や state 初期化を呼ぶ
        }

        function updateSelectedArea() {
            if (!selectedArea) return;
            selectedArea.innerHTML = '';
            const selectedCards = Array.from(document.querySelectorAll('.card.selected'));
            selectedCards.forEach(c => {
                const clone = c.cloneNode(true);
                clone.classList.remove('selected'); // サムネイルでは選択スタイルを外す
                clone.style.transform = 'none';
                selectedArea.appendChild(clone);
            });
        }

        // 初期情報の表示（デバッグ用）
        console.log('UI 初期化完了');
    });
    </script>
</body>
</html>